<UserControl
    x:Class="Dynamo.Wpf.Controls.InstalledPackagesControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:Dynamo.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:p="clr-namespace:Dynamo.Wpf.Properties"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    xmlns:ui="clr-namespace:Dynamo.UI"
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/DynamoCoreWpf;component/UI/Themes/Modern/DynamoModern.xaml" />

            </ResourceDictionary.MergedDictionaries>
            <Style x:Key="MenuItemCollapseStyle" TargetType="{x:Type MenuItem}">
                <Style.Triggers>
                    <Trigger Property="IsEnabled" Value="False">
                        <Setter Property="Visibility" Value="Collapsed" />
                    </Trigger>
                </Style.Triggers>
            </Style>
        </ResourceDictionary>
    </UserControl.Resources>

    <!--  Separate elements of this control should not be cycled through using the `Tab` key  -->
    <Grid KeyboardNavigation.IsTabStop="False">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <ItemsControl
            Name="Filters"
            Grid.Row="0"
            Grid.Column="0"
            Padding="0,5,0,5"
            VerticalContentAlignment="Center"
            Background="Transparent"
            ItemsSource="{Binding Path=Filters}"
            KeyboardNavigation.IsTabStop="False">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <WrapPanel IsItemsHost="True" Orientation="Horizontal" />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <RadioButton
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        VerticalContentAlignment="Center"
                        Background="#CCCCCC"
                        BorderBrush="Transparent"
                        BorderThickness="1"
                        Checked="ToggleButton_OnChecked"
                        Content="{Binding Path=Name, Mode=OneWay}"
                        FontFamily="Artifakt Element"
                        FontSize="11"
                        FontWeight="Medium"
                        Foreground="{StaticResource PackageManagerTabBackgroundColor}"
                        GroupName="PackageFilters"
                        IsChecked="{Binding Path=IsChecked, Mode=TwoWay}"
                        SnapsToDevicePixels="True"
                        Style="{StaticResource {x:Type ToggleButton}}"
                        UseLayoutRounding="True">
                        <RadioButton.Resources>
                            <Style TargetType="Border">
                                <Setter Property="CornerRadius" Value="8" />
                                <Setter Property="HorizontalAlignment" Value="Stretch" />
                                <Setter Property="Margin" Value="5,3,0,0" />
                                <Setter Property="Padding" Value="5,1,5,0" />
                            </Style>
                        </RadioButton.Resources>
                    </RadioButton>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        <ScrollViewer
            Grid.Row="1"
            Background="{StaticResource PreferencesWindowBackgroundColor}"
            KeyboardNavigation.IsTabStop="False"
            VerticalScrollBarVisibility="Auto">
            <ItemsControl
                Name="SearchResultsListBox"
                Padding="0"
                HorizontalContentAlignment="Stretch"
                BorderThickness="0"
                ItemsSource="{Binding Path=LocalPackages}"
                KeyboardNavigation.IsTabStop="False"
                VirtualizingPanel.ScrollUnit="Pixel">

                <ItemsControl.ItemTemplate>

                    <DataTemplate>
                        <!--
                            This border shouldn't be wider then installed packages window.
                            That's why bind its' width to ItemsPresenter's width.
                            ItemsPresenter is UI container for ListBox items.
                            ItemsPresenter can't be wider then visible part of the window.
                        -->
                        <Border
                            Width="{Binding Path=ActualWidth, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ItemsPresenter}}}"
                            Background="{StaticResource PackageManagerTabBackgroundColor}"
                            BorderBrush="{StaticResource PreferencesWindowBackgroundColor}"
                            BorderThickness="0,0,0,1">
                            <Expander
                                Name="PackageHeader"
                                IsExpanded="{Binding Path=Model.TypesVisibleInManager}"
                                Style="{StaticResource InstalledPackagesExpanderStyle}">
                                <Expander.Header>
                                    <Grid x:Name="PackageGrid">
                                        <DockPanel HorizontalAlignment="Stretch">
                                            <StackPanel
                                                Margin="10,5,5,7"
                                                HorizontalAlignment="Left"
                                                Orientation="Horizontal">
                                                <TextBlock
                                                    Width="150"
                                                    Margin="15,0,10,0"
                                                    FontSize="12"
                                                    Foreground="{StaticResource PreferencesWindowFontColor}"
                                                    Text="{Binding Path=Model.Name}"
                                                    TextTrimming="CharacterEllipsis">
                                                    <TextBlock.ToolTip>
                                                        <ToolTip Content="{Binding Path=Model.Name}" Style="{StaticResource GenericToolTipLight}" />
                                                    </TextBlock.ToolTip>
                                                </TextBlock>
                                                <TextBlock
                                                    MinWidth="70"
                                                    VerticalAlignment="Center"
                                                    FontSize="12"
                                                    Foreground="{StaticResource PreferencesWindowFontColor}"
                                                    Text="{Binding Path=Model.VersionName}" />

                                            </StackPanel>
                                            <StackPanel
                                                Width="Auto"
                                                HorizontalAlignment="Right"
                                                Orientation="Horizontal">
                                                <Grid
                                                    Height="18"
                                                    MaxWidth="150"
                                                    Margin="10,0">
                                                    <Border
                                                        Margin="5,0,0,0"
                                                        Padding="5,0,5,0"
                                                        HorizontalAlignment="Stretch"
                                                        Background="#CCCCCC"
                                                        CornerRadius="8">
                                                        <Border.ToolTip>
                                                            <ToolTip Content="{Binding Path=PackageLoadStateTooltip}" Style="{StaticResource GenericToolTipLight}" />
                                                        </Border.ToolTip>
                                                        <TextBlock
                                                            Name="PackageStateLabel"
                                                            Margin="0,2,0,0"
                                                            HorizontalAlignment="Center"
                                                            FontFamily="Artifakt Element"
                                                            FontSize="10"
                                                            FontWeight="Medium"
                                                            Foreground="{StaticResource PackageManagerTabBackgroundColor}"
                                                            Text="{Binding Path=PackageLoadStateText}"
                                                            TextAlignment="Left"
                                                            TextTrimming="CharacterEllipsis" />
                                                    </Border>
                                                </Grid>
                                                <Button
                                                    Name="MoreButton"
                                                    Width="16"
                                                    Height="16"
                                                    Margin="0,0,10,0"
                                                    Click="MoreButton_OnClick"
                                                    Style="{StaticResource MenuButtonStyle}">
                                                    <Button.ContextMenu>
                                                        <ContextMenu Style="{StaticResource ContextMenuNoLeftColumnStyle}">
                                                            <MenuItem
                                                                Name="GoToRoot"
                                                                Command="{Binding Path=GoToRootDirectoryCommand}"
                                                                Header="{x:Static p:Resources.InstalledPackageViewContextMenuShowRootDir}"
                                                                Style="{StaticResource MenuItemCollapseStyle}">
                                                                <MenuItem.ToolTip>
                                                                    <ToolTip Content="{x:Static p:Resources.InstalledPackageViewContextMenuShowRootDirTooltip}" Style="{StaticResource GenericToolTipLight}" />
                                                                </MenuItem.ToolTip>
                                                            </MenuItem>
                                                            <Separator BorderBrush="{StaticResource ExpanderCaretToggleButtonBackground}" BorderThickness="0,1,0,0" />
                                                            <MenuItem
                                                                Name="UninstallButton"
                                                                Command="{Binding Path=UninstallCommand}"
                                                                Header="{Binding Path=PackageViewContextMenuUninstallText}"
                                                                ToolTipService.ShowOnDisabled="true"
                                                                Visibility="{Binding Path=LoadedWithNoScheduledOperation, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}">
                                                                <MenuItem.ToolTip>
                                                                    <ToolTip Content="{Binding Path=PackageViewContextMenuUninstallTooltip}" Style="{StaticResource GenericToolTipLight}" />
                                                                </MenuItem.ToolTip>
                                                            </MenuItem>
                                                            <MenuItem
                                                                Name="UnmarkUninstallButton"
                                                                Command="{Binding Path=UnmarkForUninstallationCommand}"
                                                                Header="{Binding Path=PackageViewContextMenuUnmarkUninstallText}"
                                                                Style="{StaticResource MenuItemCollapseStyle}">
                                                                <MenuItem.ToolTip>
                                                                    <ToolTip Content="{Binding Path=PackageViewContextMenuUnmarkUninstallTooltip}" Style="{StaticResource GenericToolTipLight}" />
                                                                </MenuItem.ToolTip>
                                                            </MenuItem>
                                                            <MenuItem
                                                                Name="InstallButton"
                                                                Command="{Binding Path=LoadCommand}"
                                                                Header="{x:Static p:Resources.PackageViewContextMenuLoadText}"
                                                                Style="{StaticResource MenuItemCollapseStyle}">
                                                                <MenuItem.ToolTip>
                                                                    <ToolTip Content="{x:Static p:Resources.PackageViewContextMenuLoadTooltip}" Style="{StaticResource GenericToolTipLight}" />
                                                                </MenuItem.ToolTip>
                                                            </MenuItem>
                                                            <Separator
                                                                BorderBrush="{StaticResource ExpanderCaretToggleButtonBackground}"
                                                                BorderThickness="0,1,0,0"
                                                                Visibility="{Binding Path=CanPublish, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}" />
                                                            <MenuItem
                                                                Name="MakePackageButton"
                                                                Command="{Binding Path=PublishNewPackageCommand}"
                                                                Header="{x:Static p:Resources.InstalledPackageViewContextMenuPublish}"
                                                                Visibility="{Binding Path=CanPublish, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}">
                                                                <MenuItem.ToolTip>
                                                                    <ToolTip Content="{x:Static p:Resources.InstalledPackageViewContextMenuPublishTooltip}" Style="{StaticResource GenericToolTipLight}" />
                                                                </MenuItem.ToolTip>
                                                            </MenuItem>
                                                            <MenuItem
                                                                Name="MakeNewVersionButton"
                                                                Command="{Binding Path=PublishNewPackageVersionCommand}"
                                                                Header="{x:Static p:Resources.InstalledPackageViewContextMenuPublishVersion}"
                                                                Visibility="{Binding Path=CanPublishNewVersion, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}">
                                                                <MenuItem.ToolTip>
                                                                    <ToolTip Content="{x:Static p:Resources.InstalledPackageViewContextMenuPublishVersionTooltip}" Style="{StaticResource GenericToolTipLight}" />
                                                                </MenuItem.ToolTip>
                                                            </MenuItem>
                                                            <MenuItem
                                                                Name="DeprecateButton"
                                                                Command="{Binding Path=DeprecateCommand}"
                                                                Header="{x:Static p:Resources.InstalledPackageViewContextMenuDeprecate}"
                                                                Visibility="{Binding Path=CanPublish, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}">
                                                                <MenuItem.ToolTip>
                                                                    <ToolTip Content="{x:Static p:Resources.InstalledPackageViewContextMenuDeprecateTooltip}" Style="{StaticResource GenericToolTipLight}" />
                                                                </MenuItem.ToolTip>
                                                            </MenuItem>
                                                            <MenuItem
                                                                Name="UndeprecateButton"
                                                                Command="{Binding Path=UndeprecateCommand}"
                                                                Header="{x:Static p:Resources.InstalledPackageViewContextMenuRemoveDeprecation}"
                                                                Visibility="{Binding Path=CanPublish, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}">
                                                                <MenuItem.ToolTip>
                                                                    <ToolTip Content="{x:Static p:Resources.InstalledPackageViewContextMenuRemoveDeprecationTooltip}" Style="{StaticResource GenericToolTipLight}" />
                                                                </MenuItem.ToolTip>
                                                            </MenuItem>
                                                        </ContextMenu>
                                                    </Button.ContextMenu>
                                                </Button>
                                            </StackPanel>
                                        </DockPanel>
                                    </Grid>
                                </Expander.Header>
                                <Grid>
                                    <Border
                                        Background="{StaticResource ExpanderCaretToggleButtonSelectedBackground}"
                                        BorderBrush="{StaticResource ExpanderCaretToggleButtonSelectedBackground}"
                                        BorderThickness="0,0,0,0">

                                        <StackPanel Margin="25,5,5,10">

                                            <StackPanel Margin="0,0,0,5" Visibility="{Binding Path=HasCustomNodes, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}">

                                                <Label
                                                    Padding="0,5,5,5"
                                                    Content="{x:Static p:Resources.InstalledPackageViewCustomNodesLabel}"
                                                    FontSize="11"
                                                    Foreground="{StaticResource PreferencesWindowFontColor}" />
                                                <ItemsControl
                                                    Name="LoadedCustomNodes"
                                                    Background="Transparent"
                                                    ItemsSource="{Binding Path=Model.LoadedCustomNodes}">

                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <TextBlock
                                                                FontSize="11"
                                                                FontWeight="Regular"
                                                                Foreground="{StaticResource PreferencesWindowFontColor}"
                                                                Text="{Binding Path=Name}"
                                                                TextTrimming="CharacterEllipsis" />
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>

                                                </ItemsControl>

                                            </StackPanel>

                                            <StackPanel Margin="0,0,0,5" Visibility="{Binding Path=HasNodeLibraries, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}">

                                                <Label
                                                    Padding="0,5,5,5"
                                                    Content="{x:Static p:Resources.InstalledPackageViewNodeLibrariesLabel}"
                                                    FontSize="11"
                                                    Foreground="{StaticResource PreferencesWindowFontColor}" />
                                                <ItemsControl
                                                    Name="NodeLibraries"
                                                    Background="Transparent"
                                                    ItemsSource="{Binding Path=Model.LoadedAssemblies}">

                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <TextBlock
                                                                Name="Label"
                                                                FontSize="11"
                                                                FontWeight="Regular"
                                                                Foreground="{StaticResource PreferencesWindowFontColor}"
                                                                Text="{Binding Path=Name}"
                                                                TextTrimming="CharacterEllipsis" />

                                                            <DataTemplate.Triggers>
                                                                <DataTrigger Binding="{Binding Path=IsNodeLibrary}" Value="false">
                                                                    <Setter TargetName="Label" Property="Visibility" Value="Collapsed" />
                                                                </DataTrigger>
                                                            </DataTemplate.Triggers>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>

                                                </ItemsControl>
                                            </StackPanel>

                                            <StackPanel Margin="0,0,0,5" Visibility="{Binding Path=HasAdditionalAssemblies, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}">

                                                <Label
                                                    Padding="0,5,5,5"
                                                    Content="{x:Static p:Resources.InstalledPackageViewAdditionalLabel}"
                                                    FontSize="11"
                                                    Foreground="{StaticResource PreferencesWindowFontColor}" />
                                                <ItemsControl
                                                    Name="AddAssemblies"
                                                    Background="Transparent"
                                                    ItemsSource="{Binding Path=Model.LoadedAssemblies}">

                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <TextBlock
                                                                Name="Label"
                                                                FontSize="11"
                                                                FontWeight="Regular"
                                                                Foreground="{StaticResource PreferencesWindowFontColor}"
                                                                Text="{Binding Path=Name}"
                                                                TextTrimming="CharacterEllipsis" />

                                                            <DataTemplate.Triggers>
                                                                <DataTrigger Binding="{Binding Path=IsNodeLibrary}" Value="true">
                                                                    <Setter TargetName="Label" Property="Visibility" Value="Collapsed" />
                                                                </DataTrigger>
                                                            </DataTemplate.Triggers>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>

                                                </ItemsControl>

                                            </StackPanel>

                                            <StackPanel Margin="0,0,0,5" Visibility="{Binding Path=HasAdditionalFiles, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}">

                                                <Label
                                                    Padding="0,5,5,5"
                                                    Content="{x:Static p:Resources.InstalledPackageViewAdditionalFileLabel}"
                                                    FontSize="12"
                                                    Foreground="{StaticResource PreferencesWindowFontColor}" />
                                                <ItemsControl
                                                    Name="AdditionalFiles"
                                                    Background="Transparent"
                                                    ItemsSource="{Binding Path=Model.AdditionalFiles}">

                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <TextBlock
                                                                FontSize="12"
                                                                FontWeight="Regular"
                                                                Foreground="{StaticResource PreferencesWindowFontColor}"
                                                                Text="{Binding Path=RelativePath}"
                                                                TextTrimming="CharacterEllipsis" />
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>

                                                </ItemsControl>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                </Grid>
                            </Expander>
                        </Border>
                    </DataTemplate>

                </ItemsControl.ItemTemplate>

            </ItemsControl>
        </ScrollViewer>

    </Grid>

</UserControl>
